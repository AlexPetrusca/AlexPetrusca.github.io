let board=[[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,0,13,0,14,0,15,0,16,-1],[-1,17,0,18,0,19,0,20,0,-1],[-1,0,21,0,22,0,23,0,24,-1],[-1,0,0,0,0,0,0,0,0,-1],[-1,0,0,0,0,0,0,0,0,-1],[-1,1,0,2,0,3,0,4,0,-1],[-1,0,5,0,6,0,7,0,8,-1],[-1,9,0,10,0,11,0,12,0,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]],whitePieces=[{x:0,y:2,color:"W",captured:!1,king:!1},{x:2,y:2,color:"W",captured:!1,king:!1},{x:4,y:2,color:"W",captured:!1,king:!1},{x:6,y:2,color:"W",captured:!1,king:!1},{x:1,y:1,color:"W",captured:!1,king:!1},{x:3,y:1,color:"W",captured:!1,king:!1},{x:5,y:1,color:"W",captured:!1,king:!1},{x:7,y:1,color:"W",captured:!1,king:!1},{x:0,y:0,color:"W",captured:!1,king:!1},{x:2,y:0,color:"W",captured:!1,king:!1},{x:4,y:0,color:"W",captured:!1,king:!1},{x:6,y:0,color:"W",captured:!1,king:!1}],blackPieces=[{x:1,y:7,color:"B",captured:!1,king:!1},{x:3,y:7,color:"B",captured:!1,king:!1},{x:5,y:7,color:"B",captured:!1,king:!1},{x:7,y:7,color:"B",captured:!1,king:!1},{x:0,y:6,color:"B",captured:!1,king:!1},{x:2,y:6,color:"B",captured:!1,king:!1},{x:4,y:6,color:"B",captured:!1,king:!1},{x:6,y:6,color:"B",captured:!1,king:!1},{x:1,y:5,color:"B",captured:!1,king:!1},{x:3,y:5,color:"B",captured:!1,king:!1},{x:5,y:5,color:"B",captured:!1,king:!1},{x:7,y:5,color:"B",captured:!1,king:!1}],stackMoves=[];const WIDTH=600,SQUARE_WIDTH=WIDTH/8;let performingMove=!1,selectX=-1,selectY=-1,whiteToMove=!0,mustJump=!1,lastJumpX=-1,lastJumpY=-1,whiteWin=!1,blackWin=!1,whitePlayer={ai:!1},blackPlayer={ai:!0};function setup(){createCanvas(WIDTH,WIDTH),frameRate(60),textSize(64),textAlign(CENTER,CENTER),requestMove(),redraw()}function draw(){thinking||(drawBoard(),drawHighlights(),drawMoves(),drawWhitePieces(),drawBlackPieces(),drawVictoryMessage())}function drawVictoryMessage(){whiteWin?(fill(255),stroke(0),strokeWeight(5),text("White Wins!",WIDTH/2,WIDTH/2),strokeWeight(1)):blackWin&&(fill(0),stroke(255),strokeWeight(5),text("Black Wins!",WIDTH/2,WIDTH/2),strokeWeight(1))}function mouseClicked(){performingMove||requestMove()}function drawWhitePieces(){for(const e of whitePieces)stroke(0),fill(255),drawPiece(e)}function drawBlackPieces(){for(const e of blackPieces)stroke(124),fill(0),drawPiece(e)}function drawPiece(e){var t,i;e.captured||(t=e.x*SQUARE_WIDTH,i=(7-e.y)*SQUARE_WIDTH,ellipse(t+SQUARE_WIDTH/2,i+SQUARE_WIDTH/2,SQUARE_WIDTH-12,SQUARE_WIDTH-12),e.king&&(noFill(),stroke(247,191,51),rect(t+SQUARE_WIDTH/2-10,i+SQUARE_WIDTH/2-10,20,20)))}function drawHighlights(){if(!performingMove)if(hasPiece(selectX,selectY)&&whiteToMove===isWhite(selectX,selectY)&&(fill(247,191,51),rect(selectX*SQUARE_WIDTH,(7-selectY)*SQUARE_WIDTH,SQUARE_WIDTH,SQUARE_WIDTH)),noFill(),stroke(0,255,0),whiteToMove&&!whitePlayer.ai)for(const e of whitePieces)!e.captured&&isMoveableWhite(e.x,e.y)&&rect(e.x*SQUARE_WIDTH+4,(7-e.y)*SQUARE_WIDTH+4,SQUARE_WIDTH-8,SQUARE_WIDTH-8);else if(!whiteToMove&&!blackPlayer.ai)for(const t of blackPieces)!t.captured&&isMoveableBlack(t.x,t.y)&&rect(t.x*SQUARE_WIDTH+4,(7-t.y)*SQUARE_WIDTH+4,SQUARE_WIDTH-8,SQUARE_WIDTH-8)}function drawMoves(){if(noStroke(),hasPiece(selectX,selectY)&&whiteToMove===isWhite(selectX,selectY)){var e=getMoves(selectX,selectY);fill(247,191,51,200);for(const t of e)ellipse(t.toX*SQUARE_WIDTH+SQUARE_WIDTH/2,(7-t.toY)*SQUARE_WIDTH+SQUARE_WIDTH/2,SQUARE_WIDTH/5,SQUARE_WIDTH/5)}}function drawBoard(){stroke(255);let i=!0;for(let t=0;t<8;t++){for(let e=0;e<8;e++)i?fill(207,167,110):fill(102,62,15),i=!i,rect(t*SQUARE_WIDTH,e*SQUARE_WIDTH,SQUARE_WIDTH,SQUARE_WIDTH);i=!i}}function getAllMoves(){return(whiteToMove?getAllMovesWhite:getAllMovesBlack)()}function getAllMovesWhite(){var e=[];if(-1!==lastJumpX){var t=getPiece(lastJumpX,lastJumpY);addMovesInDirection(e,t,1,1,"B"),addMovesInDirection(e,t,-1,1,"B"),getPiece(t.x,t.y).king&&(addMovesInDirection(e,t,1,-1,"B"),addMovesInDirection(e,t,-1,-1,"B"))}else for(const i of whitePieces)i.captured||(addMovesInDirection(e,i,1,1,"B"),addMovesInDirection(e,i,-1,1,"B"),getPiece(i.x,i.y).king&&(addMovesInDirection(e,i,1,-1,"B"),addMovesInDirection(e,i,-1,-1,"B")));return e}function getAllMovesBlack(){var e=[];if(-1!==lastJumpX){var t=getPiece(lastJumpX,lastJumpY);addMovesInDirection(e,t,1,-1,"W"),addMovesInDirection(e,t,-1,-1,"W"),getPiece(t.x,t.y).king&&(addMovesInDirection(e,t,1,1,"W"),addMovesInDirection(e,t,-1,1,"W"))}else for(const i of blackPieces)i.captured||(addMovesInDirection(e,i,1,-1,"W"),addMovesInDirection(e,i,-1,-1,"W"),getPiece(i.x,i.y).king&&(addMovesInDirection(e,i,1,1,"W"),addMovesInDirection(e,i,-1,1,"W")));return e}function getMoves(e,t){return isWhite(e,t)?getMovesWhite(e,t):isBlack(e,t)?getMovesBlack(e,t):void 0}function getMovesWhite(e,t){var i=[],t=getPiece(e,t);return addMovesInDirection(i,t,1,1,"B"),addMovesInDirection(i,t,-1,1,"B"),t.king&&(addMovesInDirection(i,t,1,-1,"B"),addMovesInDirection(i,t,-1,-1,"B")),i}function getMovesBlack(e,t){var i=[],t=getPiece(e,t);return addMovesInDirection(i,t,1,-1,"W"),addMovesInDirection(i,t,-1,-1,"W"),t.king&&(addMovesInDirection(i,t,1,1,"W"),addMovesInDirection(i,t,-1,1,"W")),i}function addMovesInDirection(e,t,i,o,r){var n=t.x,c=t.y;hasPiece(n+i,c+o)?getPiece(n+i,c+o).color===r&&isBlank(n+2*i,c+2*o)&&e.push({fromX:n,fromY:c,toX:n+2*i,toY:c+2*o,wasKing:t.king,state:getState(),killNum:getNum(n+i,c+o)}):isBlank(n+i,c+o)&&!mustJump&&e.push({fromX:n,fromY:c,toX:n+i,toY:c+o,wasKing:t.king,state:getState()})}function getMoveablePieces(){return(whiteToMove?getMoveablePiecesWhite:getMoveablePiecesBlack)()}function getMoveablePiecesWhite(){let e=[];for(const t of whitePieces)isMoveableWhite(t.x,t.y)&&e.push(t);return e}function getMoveablePiecesBlack(){let e=[];for(const t of blackPieces)isMoveableBlack(t.x,t.y)&&e.push(t);return e}function isMoveable(e,t){return isWhite(e,t)?isMoveableWhite(e,t):isBlack(e,t)?isMoveableBlack(e,t):void 0}function isMoveableWhite(e,t){if(isMoveableInDirection(e,t,1,1,"B"))return!0;if(isMoveableInDirection(e,t,-1,1,"B"))return!0;if(getPiece(e,t).king){if(isMoveableInDirection(e,t,1,-1,"B"))return!0;if(isMoveableInDirection(e,t,-1,-1,"B"))return!0}return!1}function isMoveableBlack(e,t){if(isMoveableInDirection(e,t,1,-1,"W"))return!0;if(isMoveableInDirection(e,t,-1,-1,"W"))return!0;if(getPiece(e,t).king){if(isMoveableInDirection(e,t,1,1,"W"))return!0;if(isMoveableInDirection(e,t,-1,1,"W"))return!0}return!1}function isMoveableInDirection(e,t,i,o,r){if(hasPiece(e+i,t+o)){if(getPiece(e+i,t+o).color===r&&isBlank(e+2*i,t+2*o))return!0}else if(isBlank(e+i,t+o)&&!mustJump)return!0;return!1}function mustJumpWhite(){if(-1!==lastJumpX){var e=getPiece(lastJumpX,lastJumpY);if(mustJumpInDirection(e.x,e.y,1,1,"B"))return!0;if(mustJumpInDirection(e.x,e.y,-1,1,"B"))return!0;if(getPiece(e.x,e.y).king){if(mustJumpInDirection(e.x,e.y,1,-1,"B"))return!0;if(mustJumpInDirection(e.x,e.y,-1,-1,"B"))return!0}}else for(const t of whitePieces)if(!t.captured){if(mustJumpInDirection(t.x,t.y,1,1,"B"))return!0;if(mustJumpInDirection(t.x,t.y,-1,1,"B"))return!0;if(getPiece(t.x,t.y).king){if(mustJumpInDirection(t.x,t.y,1,-1,"B"))return!0;if(mustJumpInDirection(t.x,t.y,-1,-1,"B"))return!0}}return!1}function mustJumpBlack(){if(-1!==lastJumpX){var e=getPiece(lastJumpX,lastJumpY);if(mustJumpInDirection(e.x,e.y,1,-1,"W"))return!0;if(mustJumpInDirection(e.x,e.y,-1,-1,"W"))return!0;if(getPiece(e.x,e.y).king){if(mustJumpInDirection(e.x,e.y,1,1,"W"))return!0;if(mustJumpInDirection(e.x,e.y,-1,1,"W"))return!0}}else for(const t of blackPieces)if(!t.captured){if(mustJumpInDirection(t.x,t.y,1,-1,"W"))return!0;if(mustJumpInDirection(t.x,t.y,-1,-1,"W"))return!0;if(getPiece(t.x,t.y).king){if(mustJumpInDirection(t.x,t.y,1,1,"W"))return!0;if(mustJumpInDirection(t.x,t.y,-1,1,"W"))return!0}}return!1}function mustJumpInDirection(e,t,i,o,r){if(hasPiece(e+i,t+o)&&(getPiece(e+i,t+o).color===r&&isBlank(e+2*i,t+2*o)))return!0;return!1}function requestMove(){if(whiteToMove&&!whitePlayer.ai||!whiteToMove&&!blackPlayer.ai){let e=void 0;if(whiteToMove&&isWhite(selectX,selectY)?e=getMovesWhite(selectX,selectY):!whiteToMove&&isBlack(selectX,selectY)&&(e=getMovesBlack(selectX,selectY)),selectX=Math.floor(mouseX/SQUARE_WIDTH),selectY=7-Math.floor(mouseY/SQUARE_WIDTH),void 0!==e)for(const t of e)selectX===t.toX&&selectY===t.toY&&performMove(t)}else makeBestMove()}function performMove(t){performingMove=!0;let i=getPiece(t.fromX,t.fromY),o=Date.now();let r=setInterval(function(){var e=Date.now()-o;if(500<=e)return clearInterval(r),movePiece(i,t),checkVictory(),void switchTurns();i.x=lerp(t.fromX,t.toX,e/500),i.y=lerp(t.fromY,t.toY,e/500)},0)}function movePiece(e,t){e.x=t.toX,e.y=t.toY;var i=board[8-t.fromY][t.fromX+1];if(board[8-t.fromY][t.fromX+1]=0,board[8-t.toY][t.toX+1]=i,void 0!==t.killNum){let e=getPieceByNum(t.killNum);e.captured=!0,board[8-e.y][e.x+1]=0,lastJumpX=t.toX,lastJumpY=t.toY}("W"===e.color&&7===e.y||"B"===e.color&&0===e.y)&&(e.king=!0),stackMoves.push(t)}function performUnmove(t){performingMove=!0;let i=getPiece(t.toX,t.toY),o=Date.now();let r=setInterval(function(){var e=Date.now()-o;if(100<=e)return clearInterval(r),unmovePiece(i,t),performingMove=!1,void playbackGame();i.x=lerp(t.toX,t.fromX,e/100),i.y=lerp(t.toY,t.fromY,e/100)},0)}function unmovePiece(e,t){e.x=t.fromX,e.y=t.fromY;var i=board[8-t.toY][t.toX+1];if(board[8-t.toY][t.toX+1]=0,board[8-t.fromY][t.fromX+1]=i,void 0!==t.killNum){let e=getPieceByNum(t.killNum);e.captured=!1,board[8-e.y][e.x+1]=t.killNum}e.king=t.wasKing,whiteWin=!1,blackWin=!1,setState(t.state)}function switchTurns(){selectX=-1,selectY=-1,performingMove=!1,isMoveable(lastJumpX,lastJumpY)||(whiteToMove=!whiteToMove,lastJumpX=-1,lastJumpY=-1,mustJump=(whiteToMove?mustJumpWhite:mustJumpBlack)()),setTimeout(function(){requestMove()},100)}function playbackGame(){selectX=-1,selectY=-1,0<stackMoves.length&&performUnmove(stackMoves.pop())}function checkVictory(){var e=mustJump;mustJump=!1,isWinWhite()?(console.log("White"),whiteWin=!0,setTimeout(function(){playbackGame()},1e3)):isWinBlack()&&(console.log("Black"),blackWin=!0,setTimeout(function(){playbackGame()},1e3)),mustJump=e}function isWinWhite(){for(const e of blackPieces)if(!e.captured&&(isMoveableBlack(e.x,e.y)||!whiteToMove))return!1;return!0}function isWinBlack(){for(const e of whitePieces)if(!e.captured&&isMoveableWhite(e.x,e.y)||whiteToMove)return!1;return!0}function getPiece(e,t){e=board[8-t][e+1];return 1<=e&&e<=12?whitePieces[e-1]:13<=e&&e<=24?blackPieces[e-12-1]:void 0}function getPieceByNum(e){return 1<=e&&e<=12?whitePieces[e-1]:13<=e&&e<=24?blackPieces[e-12-1]:void 0}function hasPiece(e,t){e=board[8-t][e+1];return 1<=e&&e<=24}function isOutOfBounds(e,t){return-1===board[8-t][e+1]}function isBlank(e,t){return 0===board[8-t][e+1]}function isWhite(e,t){e=board[8-t][e+1];return 1<=e&&e<=12}function isBlack(e,t){e=board[8-t][e+1];return 13<=e&&e<=24}function getNum(e,t){return board[8-t][e+1]}function colorOf(e,t){return isWhite(e,t)?"W":isBlack(e,t)?"B":void 0}function getState(){return{whiteToMove:whiteToMove,mustJump:mustJump,lastJumpX:lastJumpX,lastJumpY:lastJumpY}}function setState(e){whiteToMove=e.whiteToMove,mustJump=e.mustJump,lastJumpX=e.lastJumpX,lastJumpY=e.lastJumpY}