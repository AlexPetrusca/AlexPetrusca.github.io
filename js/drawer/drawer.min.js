let VSHADER_SOURCE=null,FSHADER_SOURCE=null;const FSIZE=(new Float32Array).BYTES_PER_ELEMENT,VERTEX_SIZE=10;let g_points=[],shadingMode=1,xTranslate=0,lightPos=[1,1,1],x=0,y=0,z=0,thetaX=0,thetaY=0,thetaZ=0,shearX=0,shearY=0,scale=1,lx=1,ly=1,lz=1,lthetaX=0,lthetaY=0,lthetaZ=0,lshearX=0,lshearY=0,lscale=.1;function main(){let t=document.getElementById("canvas"),n=getWebGLContext(t);n?(loadFile("js/drawer/shader.vert",function(e){setShader(n,t,n.VERTEX_SHADER,e)}),loadFile("js/drawer/shader.frag",function(e){setShader(n,t,n.FRAGMENT_SHADER,e)})):console.log("Failed to get the rendering context for WebGL")}function setShader(e,t,n,r){n===e.VERTEX_SHADER?VSHADER_SOURCE=r:n===e.FRAGMENT_SHADER&&(FSHADER_SOURCE=r),VSHADER_SOURCE&&FSHADER_SOURCE&&start(e,t)}function start(t,n){var e;initShaders(t,VSHADER_SOURCE,FSHADER_SOURCE)?(e=(e=(e=(e=initVertexBuffer(t))&&initIndexBuffer(t))&&initAttributes(t))&&initUniforms(t,n),initHTMLVars(),initGLOptions(t),e?(n.onmousedown=function(e){clickDraw(e,t,n)},n.onmousemove=function(e){move(e,t,n)},window.onkeydown=function(e){keypress(e,t)},document.getElementById("rAmbient").onchange=function(){updateAmbient(t)},document.getElementById("gAmbient").onchange=function(){updateAmbient(t)},document.getElementById("bAmbient").onchange=function(){updateAmbient(t)},document.getElementById("rSpecular").onchange=function(){updateSpecular(t)},document.getElementById("gSpecular").onchange=function(){updateSpecular(t)},document.getElementById("bSpecular").onchange=function(){updateSpecular(t)},document.getElementById("ySpin").onclick=function(){ySpinAnim(t)},document.getElementById("square").onclick=function(){squareAnim(t)},document.getElementById("gravity").onclick=function(){gravityAnim(t)},document.getElementById("nSlide").oninput=function(){updateSpecularConsant(t)}):console.log("Failed to initialize buffers.")):console.log("Failed to intialize shaders.")}function initGLOptions(e){e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.enable(e.DEPTH_TEST),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}function updateSpecularConsant(e){var t=document.getElementById("nSlide").value;e.uniform1f(u_SpecularConstant,parseInt(t)),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),drawScene(e)}function initHTMLVars(){document.getElementById("rAmbient").value=0,document.getElementById("gAmbient").value=0,document.getElementById("bAmbient").value=51,document.getElementById("rSpecular").value=0,document.getElementById("gSpecular").value=255,document.getElementById("bSpecular").value=0}function updateAmbient(e){var t=document.getElementById("rAmbient"),n=document.getElementById("gAmbient"),r=document.getElementById("bAmbient");e.uniform3f(u_AmbientColor,parse255(t),parse255(n),parse255(r)),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),drawScene(e)}function updateSpecular(e){var t=document.getElementById("rSpecular"),n=document.getElementById("gSpecular"),r=document.getElementById("bSpecular");e.uniform3f(u_SpecularColor,parse255(t),parse255(n),parse255(r)),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),drawScene(e)}function parse255(e){let t=parseInt(e.value);return 255<t?(t=255,e.value=t):t<0&&(t=0,e.value=t),t/255}function initVertexBuffer(e){var t=e.createBuffer();return t?(e.bindBuffer(e.ARRAY_BUFFER,t),!0):(console.log("failed to create vertex buffer"),!1)}function initIndexBuffer(e){var t=e.createBuffer();return t?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),!0):(console.log("failed to create index buffer"),!1)}function initAttributes(e){var t=e.getAttribLocation(e.program,"a_Position"),n=e.getAttribLocation(e.program,"a_Color"),r=e.getAttribLocation(e.program,"a_Normal");return t<0&&n<0&&r<0?(console.log("failed to get storage location of attribute"),!1):(e.vertexAttribPointer(t,3,e.FLOAT,!1,FSIZE*VERTEX_SIZE,0),e.enableVertexAttribArray(t),e.vertexAttribPointer(n,4,e.FLOAT,!1,FSIZE*VERTEX_SIZE,3*FSIZE),e.enableVertexAttribArray(n),e.vertexAttribPointer(r,3,e.FLOAT,!1,FSIZE*VERTEX_SIZE,7*FSIZE),e.enableVertexAttribArray(r),!0)}let u_ModelMatrix,u_NormalMatrix,u_ViewMatrix,u_ProjMatrix,u_ShadingStyle,u_LightColor,u_LightPosition,u_ViewPosition,u_AmbientColor,u_SpecularColor,u_SpecularConstant,u_Selected_Click,u_Light;function initUniforms(e,t){u_ModelMatrix=e.getUniformLocation(e.program,"u_ModelMatrix"),u_NormalMatrix=e.getUniformLocation(e.program,"u_NormalMatrix"),u_ViewMatrix=e.getUniformLocation(e.program,"u_ViewMatrix"),u_ProjMatrix=e.getUniformLocation(e.program,"u_ProjMatrix"),u_ShadingStyle=e.getUniformLocation(e.program,"u_ShadingStyle"),u_LightColor=e.getUniformLocation(e.program,"u_LightColor"),u_LightPosition=e.getUniformLocation(e.program,"u_LightPosition"),u_ViewPosition=e.getUniformLocation(e.program,"u_ViewPosition"),u_AmbientColor=e.getUniformLocation(e.program,"u_AmbientColor"),u_SpecularColor=e.getUniformLocation(e.program,"u_SpecularColor"),u_SpecularConstant=e.getUniformLocation(e.program,"u_SpecularConstant"),u_Selected_Click=e.getUniformLocation(e.program,"u_Selected_Click"),u_Light=e.getUniformLocation(e.program,"u_Light");let n=new Matrix4,r=new Matrix4;return n.setLookAt(0,0,5,0,0,-100,0,1,0),r.setPerspective(30,t.width/t.height,1,100),e.uniformMatrix4fv(u_ModelMatrix,!1,(new Matrix4).elements),e.uniformMatrix4fv(u_NormalMatrix,!1,(new Matrix4).elements),e.uniformMatrix4fv(u_ViewMatrix,!1,n.elements),e.uniformMatrix4fv(u_ProjMatrix,!1,r.elements),e.uniform1f(u_ShadingStyle,shadingMode),e.uniform3fv(u_LightColor,new Float32Array([1,1,1])),e.uniform3fv(u_LightPosition,new Float32Array(lightPos)),e.uniform3fv(u_ViewPosition,new Float32Array([0,0,5])),e.uniform3fv(u_AmbientColor,[0,0,.2]),e.uniform3fv(u_SpecularColor,[0,1,0]),e.uniform1f(u_SpecularConstant,8),e.uniform1f(u_Selected_Click,0),e.uniform1f(u_Light,0),!0}function setVertexBuffer(e,t){e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW)}function setIndexBuffer(e,t){e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.DYNAMIC_DRAW)}function drawPolyline(e){e.uniform1f(u_ShadingStyle,0),setVertexBuffer(e,new Float32Array(g_points));var t=g_points.length/VERTEX_SIZE;e.drawArrays(e.LINE_STRIP,0,t)}function drawLineTo(e,t,n){var r=[],o=g_points.length-1;pushVector(r,[g_points[o-(VERTEX_SIZE-1)],g_points[o-(VERTEX_SIZE-2)],0]),pushVector(r,[1,0,0,1]),pushVector(r,[1,1,1]),pushVector(r,[t,n,0]),pushVector(r,[1,0,0,1]),pushVector(r,[1,1,1]),e.uniform1f(u_ShadingStyle,0),setVertexBuffer(e,new Float32Array(r)),e.drawArrays(e.LINE_STRIP,0,2)}function drawScene(e){updateModelMatrix(e),drawCylinders(e),lupdateModelMatrix(e),drawPointLight(e)}function drawCylinders(t){t.uniform1f(u_ShadingStyle,shadingMode),cylinders.forEach(function(e){setVertexBuffer(t,new Float32Array(e.verts)),setIndexBuffer(t,new Uint16Array(e.inds)),t.drawElements(t.TRIANGLES,e.inds.length,t.UNSIGNED_SHORT,0)})}function drawPointLight(e){var t=[];pushVector(t,[1,1,1,1,1,0,253/255,0,0,1]),pushVector(t,[-1,1,1,1,1,0,253/255,0,0,1]),pushVector(t,[-1,-1,1,1,1,0,253/255,0,0,1]),pushVector(t,[1,-1,1,1,1,0,253/255,0,0,1]),pushVector(t,[1,1,1,1,1,0,253/255,1,0,0]),pushVector(t,[1,-1,1,1,1,0,253/255,1,0,0]),pushVector(t,[1,-1,-1,1,1,0,253/255,1,0,0]),pushVector(t,[1,1,-1,1,1,0,253/255,1,0,0]),pushVector(t,[1,1,1,1,1,0,253/255,0,1,0]),pushVector(t,[1,1,-1,1,1,0,253/255,0,1,0]),pushVector(t,[-1,1,-1,1,1,0,253/255,0,1,0]),pushVector(t,[-1,1,1,1,1,0,253/255,0,1,0]),pushVector(t,[-1,1,1,1,1,0,253/255,-1,0,0]),pushVector(t,[-1,1,-1,1,1,0,253/255,-1,0,0]),pushVector(t,[-1,-1,-1,1,1,0,253/255,-1,0,0]),pushVector(t,[-1,-1,1,1,1,0,253/255,-1,0,0]),pushVector(t,[-1,-1,-1,1,1,0,253/255,0,-1,0]),pushVector(t,[1,-1,-1,1,1,0,253/255,0,-1,0]),pushVector(t,[1,-1,1,1,1,0,253/255,0,-1,0]),pushVector(t,[-1,-1,1,1,1,0,253/255,0,-1,0]),pushVector(t,[1,-1,-1,1,1,0,253/255,0,0,-1]),pushVector(t,[-1,-1,-1,1,1,0,253/255,0,0,-1]),pushVector(t,[-1,1,-1,1,1,0,253/255,0,0,-1]),pushVector(t,[1,1,-1,1,1,0,253/255,0,0,-1]);var n=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];setVertexBuffer(e,new Float32Array(t)),setIndexBuffer(e,new Uint16Array(n)),e.uniform1f(u_Light,1),e.drawElements(e.TRIANGLES,n.length,e.UNSIGNED_SHORT,0),e.uniform1f(u_Light,0)}function pushCyl(e,t){cylinders.push({verts:e,inds:t})}let cylinders=[],verts=[],inds=[],n=12,width=.2;function makeCylinders(e){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);for(let e=0;e<g_points.length/VERTEX_SIZE-1;e++)makeCylinder(e);makeIntersections(),makeCaps(),pushCyl(verts,inds)}function makeIntersections(){var t=VERTEX_SIZE*(n+1)*2;for(let e=0;e<verts.length/t-1;e++){var r=e*t,o=(e+1)*t;for(let e=r;e<o;e+=2*VERTEX_SIZE){var a=getIntersection(verts[e],verts[e+1],verts[e+VERTEX_SIZE],verts[e+VERTEX_SIZE+1],verts[e+t],verts[e+t+1],verts[e+t+VERTEX_SIZE],verts[e+t+VERTEX_SIZE+1]);verts[e]=a.x,verts[e+1]=a.y,verts[e+t+VERTEX_SIZE]=a.x,verts[e+t+VERTEX_SIZE+1]=a.y}}}function makeCaps(){let t=getAffine(0);var r=getLength(0);let o=getAffine(g_points.length/VERTEX_SIZE-2);var a=getLength(g_points.length/VERTEX_SIZE-2),e=t.multiplyVector3(new Vector3([-r/2,0,0])).elements,i=o.multiplyVector3(new Vector3([a/2,0,0])).elements,l=t.multiplyVector3(new Vector3([r/2,0,0])).elements,u=o.multiplyVector3(new Vector3([-a/2,0,0])).elements,s=getSubtraction(e,l),c=getSubtraction(i,u),d=2*Math.PI/n;let E=0;for(let e=0;e<n+1;e++){var f=width*Math.cos(E),_=width*Math.sin(E),_=t.multiplyVector3(new Vector3([-r/2,f,_])).elements;pushVector(verts,_),pushVector(verts,[1,0,0,254/255]),pushVector(verts,s),E+=d}for(let e=E=0;e<n+1;e++){var g=width*Math.cos(E),h=width*Math.sin(E),h=o.multiplyVector3(new Vector3([a/2,g,h])).elements;pushVector(verts,h),pushVector(verts,[1,0,0,254/255]),pushVector(verts,c),E+=d}pushVector(verts,e),pushVector(verts,[1,0,0,254/255]),pushVector(verts,s),pushVector(verts,i),pushVector(verts,[1,0,0,254/255]),pushVector(verts,c);var i=verts.length/VERTEX_SIZE,m=i-2,p=i-1;let S=i-2*(n+1)-2;for(let e=S;e<n+S;e++)pushVector(inds,[e+1,e,m]);S+=n+1;for(let e=S;e<n+S;e++)pushVector(inds,[e,e+1,p])}function makeCylinder(e){var t=g_points[e*VERTEX_SIZE],r=g_points[e*VERTEX_SIZE+1],o=g_points[e*VERTEX_SIZE+VERTEX_SIZE],a=g_points[e*VERTEX_SIZE+VERTEX_SIZE+1];let i=0;var l=2*Math.PI/n,u=Math.sqrt((o-t)**2+(a-r)**2),s=Math.atan((a-r)/(o-t));let c=new Matrix4;0<=t-o?(c.translate(t,r,0),c.rotate(s+Math.PI,0,0,1),c.translate(u/2,0,0)):(c.translate(o,a,0),c.rotate(s,0,0,1),c.translate(-u/2,0,0));var d=c.multiplyVector3(new Vector3([u/2,0,0])).elements,E=c.multiplyVector3(new Vector3([-u/2,0,0])).elements;for(let e=0;e<n+1;e++){var f=width*Math.cos(i),_=width*Math.sin(i),g=c.multiplyVector3(new Vector3([u/2,f,_])).elements,_=c.multiplyVector3(new Vector3([-u/2,f,_])).elements;pushVector(verts,g),pushVector(verts,[1,0,0,254/255]),pushVector(verts,getSubtraction(g,d)),pushVector(verts,_),pushVector(verts,[1,0,0,254/255]),pushVector(verts,getSubtraction(_,E)),i+=l}var h=2*(n+1)*e;for(let e=h;e<2*n+h;e+=2)pushVector(inds,[e,e+1,e+2]),pushVector(inds,[e+2,e+1,e+3])}function getVertex(e){return[verts[e*VERTEX_SIZE],verts[e*VERTEX_SIZE+1],verts[e*VERTEX_SIZE+2]]}function getNormal(e){return[verts[e*VERTEX_SIZE+6],verts[e*VERTEX_SIZE+7],verts[e*VERTEX_SIZE+8]]}function getAffine(e){var t=g_points[e*VERTEX_SIZE],n=g_points[e*VERTEX_SIZE+1],r=g_points[e*VERTEX_SIZE+VERTEX_SIZE],o=g_points[e*VERTEX_SIZE+VERTEX_SIZE+1],a=Math.sqrt((r-t)**2+(o-n)**2),e=Math.atan((o-n)/(r-t));let i=new Matrix4;return 0<=t-r?(i.translate(t,n,0),i.rotate(e+Math.PI,0,0,1),i.translate(a/2,0,0)):(i.translate(r,o,0),i.rotate(e,0,0,1),i.translate(-a/2,0,0)),i}function getLength(e){var t=g_points[e*VERTEX_SIZE],n=g_points[e*VERTEX_SIZE+1],r=g_points[e*VERTEX_SIZE+VERTEX_SIZE],e=g_points[e*VERTEX_SIZE+VERTEX_SIZE+1];return Math.sqrt((r-t)**2+(e-n)**2)}let isYSpin=!1;function ySpinAnim(e){isYSpin=!isYSpin,isYSpin&&window.requestAnimationFrame(function(){loopYSpin(0,e)})}function drawYSpin(e){thetaY+=Math.PI/100,lthetaY+=Math.PI/100,e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),drawScene(e)}function loopYSpin(e,t){drawYSpin(t),isYSpin&&window.requestAnimationFrame(function(){loopYSpin(0,t)})}let isSquare=!1,phase=0,xOld=0,yOld=0,lxOld=0,lyOld=0,delY=0,delX=0;function squareAnim(e){isSquare=!isSquare,xOld=x,yOld=y,lxOld=lx,lyOld=ly,delY=0,delX=0,isSquare&&window.requestAnimationFrame(function(){loopSquare(0,e)})}function drawSquare(e){switch(phase){case 0:x=xOld+delX,lx=lxOld+delX,delX+=.01,.25<=delX&&phase++;break;case 1:y=yOld+delY,ly=lyOld+delY,delY+=.01,.25<=delY&&phase++;break;case 2:x=xOld+delX,lx=lxOld+delX,delX-=.01,delX<=-.25&&phase++;break;case 3:y=yOld+delY,ly=lyOld+delY,delY-=.01,delY<=-.25&&(phase=0)}e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),drawScene(e)}function loopSquare(e,t){drawSquare(t),isSquare&&window.requestAnimationFrame(function(){loopSquare(0,t)})}let isGravity=!1,velocity=0,acceleration=-5e-4;function gravityAnim(e){isGravity=!isGravity,isGravity?window.requestAnimationFrame(function(){loopGravity(0,e)}):velocity=0}function drawGravity(e){y+=velocity,velocity+=acceleration,ly+=velocity,velocity+=acceleration,e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),drawScene(e)}function loopGravity(e,t){drawGravity(t),isGravity&&window.requestAnimationFrame(function(){loopGravity(0,t)})}function keypress(e,t){1!==selected&&2!==selected||(1===selected?(87===e.keyCode&&(shearX+=.1),83===e.keyCode&&(shearX-=.1),68===e.keyCode&&(shearY+=.1),65===e.keyCode&&(shearY-=.1)):2===selected&&(87===e.keyCode&&(lshearX+=.1),83===e.keyCode&&(lshearX-=.1),68===e.keyCode&&(lshearY+=.1),65===e.keyCode&&(lshearY-=.1))),39===e.keyCode?shadingMode+=1:37===e.keyCode&&--shadingMode,5<shadingMode&&(shadingMode=5),shadingMode<1&&(shadingMode=1);let n=document.getElementById("shading");1===shadingMode?n.innerText="Gouraud":2===shadingMode?n.innerText="Phong":3===shadingMode?n.innerText="Depth":4===shadingMode?n.innerText="Rim":5===shadingMode&&(n.innerText="Cel"),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),drawScene(t)}let flag=0,lastPos=null,selected=0;function clickSelect(e,t,n){flag=e.button+1,lastPos=glMouseCoords(e,n),t.clear(t.COLOR_BUFFER_BIT),drawScene(t);e=canvasMouseCoords(e,n),n=new Uint8Array(4);t.readPixels(e.x,e.y,1,1,t.RGBA,t.UNSIGNED_BYTE,n),console.log("Color:"+n),selected=253===n[3]?2:254===n[3]?1:0,t.uniform1f(u_Selected_Click,selected),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),drawScene(t)}function unclick(e,t,n){lastPos=glMouseCoords(e,n),flag=0}function dragM(e,t,n){var r;1!==selected&&2!==selected||(e=(r=glMouseCoords(e,n)).x-lastPos.x,n=r.y-lastPos.y,1===selected?1===flag?translateXYM(e,n):2===flag?(translateZM(n),rotateZM(e)):3===flag&&rotateXYM(e,n):2===selected&&(1===flag?ltranslateXYM(t,e,n):2===flag?(ltranslateZM(t,n),lrotateZM(e)):3===flag&&lrotateXYM(e,n)),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),drawScene(t),lastPos=r)}function lrotateZM(e){lthetaZ+=e}function ltranslateZM(e,t){lz+=t,e.uniform3fv(u_LightPosition,new Float32Array([lx,ly,lz]))}function ltranslateXYM(e,t,n){lx+=t,ly+=n,e.uniform3fv(u_LightPosition,new Float32Array([lx,ly,lz]))}function lrotateXYM(e,t){lthetaX+=t,lthetaY+=e}function rotateZM(e){thetaZ+=e}function translateZM(e){z+=e}function translateXYM(e,t){x+=e,y+=t}function rotateXYM(e,t){thetaX+=t,thetaY+=e}function scaleM(e,t){1===selected?scale+=e.deltaY/500:2===selected&&(lscale+=e.deltaY/500),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),drawScene(t)}function updateModelMatrix(e){let t=new Matrix4;t.translate(x,y,z),t.rotate(thetaX,1,0,0),t.rotate(thetaY,0,1,0),t.rotate(thetaZ,0,0,1),t.scale(scale,scale,scale),t.multiply(getShearMatrix(shearX,shearY)),e.uniformMatrix4fv(u_ModelMatrix,!1,t.elements),t.invert(),t.transpose(),e.uniformMatrix4fv(u_NormalMatrix,!1,t.elements)}function lupdateModelMatrix(e){let t=new Matrix4;t.translate(lx,ly,lz),t.rotate(lthetaX,1,0,0),t.rotate(lthetaY,0,1,0),t.rotate(lthetaZ,0,0,1),t.scale(lscale,lscale,lscale),t.multiply(getShearMatrix(lshearX,lshearY)),e.uniformMatrix4fv(u_ModelMatrix,!1,t.elements)}function getShearMatrix(e,t){let n={};return n.elements=[1,e,0,0,t,1,0,0,0,0,1,0,0,0,0,1],new Matrix4(n)}function clickDraw(e,t,n){var r;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),0===e.button?(r=glMouseCoords(e,n),pushVector(g_points,[r.x,r.y,0]),pushVector(g_points,[0,1,0,1]),pushVector(g_points,[1,1,1]),drawPolyline(t)):2===e.button&&1<g_points.length/VERTEX_SIZE&&(makeCylinders(t),drawScene(t),g_points=[],n.onmousemove=function(e){dragM(e,t,n)},window.onmousewheel=function(e){scaleM(e,t)},n.onmousedown=function(e){clickSelect(e,t,n)},n.onmouseup=function(e){unclick(e,t,n)})}function move(e,t,n){n=glMouseCoords(e,n);t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),0<g_points.length&&(drawPolyline(t),drawLineTo(t,n.x,n.y))}function drawPoint2D(e,t,n){setVertexBuffer(e,new Float32Array([t,n,0,1,0,0,1,1,1,1])),e.drawArrays(e.POINTS,0,1)}function drawPoint3D(e,t,n,r){setVertexBuffer(e,new Float32Array([t,n,r,1,0,0,1,1,1,1])),e.drawArrays(e.POINTS,0,1)}function drawLine2D(e,t,n,r,o){setVertexBuffer(e,new Float32Array([t,n,0,1,0,0,1,1,1,1,r,o,0,1,0,0,1,1,1,1])),e.drawArrays(e.LINES,0,2)}function drawLine3D(e,t,n,r,o,a,i){setVertexBuffer(e,new Float32Array([t,n,r,1,0,0,1,1,1,1,o,a,i,1,0,0,1,1,1,1])),e.drawArrays(e.LINES,0,2)}function drawNormal(e,t){var n=getVertex(inds[t]),t=getAddition(n,getScaled(normalize(getNormal(inds[t])),.2));drawPoint3D(e,n[0],n[1],n[2]),drawLine3D(e,n[0],n[1],n[2],t[0],t[1],t[2])}function getSurfaceNormal(e,t,n){return getCrossProduct([t[0]-e[0],t[1]-e[1],t[2]-e[2]],[n[0]-e[0],n[1]-e[1],n[2]-e[2]])}function getNormalizedSurfaceNormal(e,t,n){return normalize(getCrossProduct([t[0]-e[0],t[1]-e[1],t[2]-e[2]],[n[0]-e[0],n[1]-e[1],n[2]-e[2]]))}function getCentroid(e,t,n){return[(e[0]+t[0]+n[0])/3,(e[1]+t[1]+n[1])/3,(e[2]+t[2]+n[2])/3]}function getAddition(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function getSubtraction(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}function getDotProduct(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function getScaled(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function getCrossProduct(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function normalize(e){var t=magnitude(e);return[e[0]/t,e[1]/t,e[2]/t]}function magnitude(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2)}function getIntersection(e,t,n,r,o,a,i,l){n=(r-t)/(n-e),i=(l-a)/(i-o);return{x:(n*e-i*o+a-t)/(n-i),y:(i*t-n*a+n*i*(o-e))/(i-n)}}function pushVector(e,t){for(var n of t)e.push(n)}function glMouseCoords(e,t){var n=e.clientX,r=e.clientY,e=e.target.getBoundingClientRect();return{x:n=(n-e.left-t.width/2)/(t.width/2),y:r=(t.height/2-(r-e.top))/(t.height/2)}}function canvasMouseCoords(e,t){var n=e.clientX,r=e.clientY,e=e.target.getBoundingClientRect();return{x:n-=e.left,y:t.height-(r-1.5*e.top)}}